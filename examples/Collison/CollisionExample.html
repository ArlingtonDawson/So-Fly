<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/prototype/1.7.2.0/prototype.js"></script>
    <script src="../../libraries/QuadTreeES6Conversion.js"></script>
    
</head>
<body onload ="StartUp()">
    <canvas id="example" height="800" width="800"/>
    <script>
        //BIG TODO!
        //Clean this up and possibly create a cool little libary
        //Also add the ablity for the user to modify some of the hard set settings.
        var shapes = [];
        var maxitems =1000;
        var maxsquare = 10;
        var canvas = document.getElementById("example");
        var canvascontext = canvas.getContext("2d");
        var nonCollidColor = "#000000";
        var CollidColor = "#FF0000";
        var width = canvas.width;
        var height = canvas.height;
        var maxVelocity = 2;
        let collisond;
        var whichway = 1;
        function StartUp()
        {


            collisond = new QuadTree({
                "x": 0,
                "y": 0,
                "width": 800,
                "height": 800
            }, 40, 20);
            var drawing = false;
            for (var itemloop = 0; itemloop < maxitems; itemloop++) {

                var x = Math.floor((Math.random() * width) + 1);
                var y = Math.floor((Math.random() * height) + 1);
                var sqwidth = Math.floor((Math.random() * maxsquare) + 3);
                var xspeed = Math.floor((Math.random() * maxVelocity) + 1) * whichway;
                var yspeed = Math.floor((Math.random() * maxVelocity) + 1) * whichway;
                

                var newItem = {
                    "x": x,
                    "y": y,
                    "width": sqwidth,
                    "height": sqwidth,
                    "xspeed": xspeed,
                    "yspeed": yspeed
                }
                whichway = whichway * -1;

                shapes.push(newItem);
            }
            collisond.Insert(shapes);

        

        function timer()
        {
                moveobjects();
                draw();
                setTimeout(timer, 1);
        }

        function moveobjects()
        {   
            collisond.Clear();
            for (var index = 0; index < shapes.length; index++) {
                var shape = shapes[index];
                if (shape.x + shape.xspeed > width || shape.x + shape.xspeed < 0)
                    shape.xspeed  = shape.xspeed * -1;
                if (shape.y + shape.yspeed > height || shape.y + shape.yspeed < 0)
                    shape.yspeed = shape.yspeed * -1;

                shape.x = shape.x + shape.xspeed;
                shape.y = shape.y + shape.yspeed;
                shapes[index] = shape;
            };

            //Insert into the collison detection lib.
            collisond.Insert(shapes);
        }

        function draw()
        {
            canvascontext.clearRect(0, 0, width, height);
            //console.log(collisond.getAllContent());
            shapes.forEach(i => {
                let collides = collisond.GetCollides(i);
                canvascontext.fillStyle = nonCollidColor;

                if (collides.length > 0)
                    collides.forEach(c => {
                        if (i != c && (i.x < c.x + i.width && i.x + i.width > c.x && i.y < c.y + c.height && i.y + i.height > c.y))
                            {
                            canvascontext.fillStyle = CollidColor;
                            return;
                        }
                    })
                    

                canvascontext.fillRect(i.x, i.y, i.width, i.height);
            });
                
        }

        timer();
        }
    </script>
</body>
</html>